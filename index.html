<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Avaliação de Segurança e Automação</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background-color: #f2f2f2; }
  #quiz-container { display: none; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  .question { margin-bottom: 20px; }
  .options label { display: block; margin-bottom: 5px; }
  button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
  button:hover { background: #0056b3; }
  #result { display: none; background: #fff; margin-top: 20px; padding: 20px; border-radius: 10px; }
  textarea { width: 100%; height: 80px; margin-top: 5px; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <div id="name-modal">
    <h2>Bem-vindo à Avaliação</h2>
    <label>Digite seu nome para iniciar:</label>
    <input type="text" id="userName" />
    <button id="start-btn">Iniciar Avaliação</button>
  </div>

  <div id="quiz-container"></div>

  <div id="result"></div>

  <script defer>
    const quizData = [
      { question: '1. A segurança do trabalho tem como principal objetivo:', options: ['Reduzir os custos da empresa.', 'Evitar multas e processos.', 'Prevenir acidentes e proteger a integridade física e mental do trabalhador.', 'Cumprir exigências legais apenas.'], correct: 2 },
      { question: '2. Uma empresa que valoriza a segurança investe em:', options: ['Apenas equipamentos novos.', 'Treinamento contínuo e cultura de prevenção.', 'Campanhas de marketing interno.', 'Uniformes padronizados sem instrução de uso.'], correct: 1 },
      { question: '3. O órgão federal responsável por fiscalizar o cumprimento das normas trabalhistas, incluindo segurança, é:', options: ['CREA', 'IBAMA', 'Ministério do Trabalho', 'CIPA'], correct: 2 },
      { question: '4. As Normas Regulamentadoras (NRs) são publicadas e fiscalizadas por:', options: ['Ministério da Saúde', 'Ministério do Trabalho e Emprego', 'INMETRO', 'Corpo de Bombeiros'], correct: 1 },
      { question: '5. Em um ambiente industrial, a análise estatística de acidentes serve para:', options: ['Registrar apenas acidentes graves.', 'Identificar padrões e prevenir ocorrências futuras.', 'Alimentar relatórios administrativos sem utilidade prática.', 'Aumentar a burocracia interna.'], correct: 1 },
      { question: '6. Sobre os custos dos acidentes de trabalho, é correto afirmar:', options: ['Envolvem apenas gastos com hospitalização.', 'Não afetam a produtividade.', 'Podem incluir prejuízos materiais, humanos e de imagem da empresa.', 'São sempre cobertos pelo seguro da empresa.'], correct: 2 },
      { question: '7. Um Programa de Segurança da Empresa bem elaborado deve:', options: ['Ser genérico e igual para todas as empresas.', 'Adaptar-se aos riscos e processos específicos de cada ambiente.', 'Focar apenas em incêndios.', 'Ser feito apenas para cumprir auditorias.'], correct: 1 },
      { question: '8. Os sistemas preventivos e de combate a incêndios incluem:', options: ['Extintores, alarmes e hidrantes.', 'Somente extintores.', 'Apenas saídas de emergência.', 'Luzes de emergência e câmeras.'], correct: 0 },
      { question: '9. O EPI deve ser:', options: ['Escolhido pelo funcionário.', 'Fornecido gratuitamente e adequado ao risco.', 'Comprado pelo trabalhador.', 'Usado apenas em fiscalizações.'], correct: 1 },
      { question: '10. A NR 10 trata de:', options: ['Máquinas e equipamentos.', 'Eletricidade.', 'Ergonomia.', 'Construção civil.'], correct: 1 },
      { question: '11. A NR 12 trata de:', options: ['Segurança em máquinas e equipamentos.', 'Riscos biológicos.', 'Energia elétrica.', 'Escavações e demolições.'], correct: 0 },
      { question: '12. A NR 5410 é uma norma técnica da ABNT que trata de:', options: ['Instalações elétricas de baixa tensão.', 'Prevenção de incêndios.', 'Instalações hidráulicas.', 'Segurança do trabalho em altura.'], correct: 0 },
      { question: '13. Um exemplo de risco físico é:', options: ['Poeira.', 'Ruído.', 'Produto químico.', 'Vírus.'], correct: 1 },
      { question: '14. Um risco químico está associado a:', options: ['Vibrações.', 'Radiações.', 'Vapores e gases.', 'Ferramentas manuais.'], correct: 2 },
      { question: '15. Em eletricidade, o maior risco ocupacional está relacionado a:', options: ['Choque elétrico e arco voltaico.', 'Esforço físico repetitivo.', 'Ruído.', 'Temperatura ambiente.'], correct: 0 },
      { question: '16. A proteção de máquinas e ferramentas deve:', options: ['Ser removida para facilitar manutenção.', 'Ser mantida sempre que houver partes móveis expostas.', 'Ser opcional, dependendo da experiência do operador.', 'Ser instalada apenas em equipamentos novos.'], correct: 1 },
      { question: '17. O treinamento de segurança deve ocorrer:', options: ['Apenas quando há acidentes.', 'Antes do início das atividades e sempre que houver mudanças no processo.', 'Uma vez por ano.', 'Apenas quando exigido por auditorias.'], correct: 1 },
      { question: '18. Um ambiente ecologicamente equilibrado depende de:', options: ['Ações isoladas da empresa.', 'Integração entre gestão ambiental e responsabilidade social.', 'Apenas da reciclagem de resíduos.', 'Proibição de produtos químicos.'], correct: 1 },
      { question: '19. A poluição e a contaminação diferem porque:', options: ['Poluição é natural, contaminação é química.', 'Contaminação afeta diretamente seres vivos; poluição é mais ampla, afetando o meio como um todo.', 'São sinônimos.', 'Nenhuma delas é problema em ambiente industrial.'], correct: 1 },
      { question: '20. A exploração consciente de energia e recursos minerais deve:', options: ['Visar apenas o lucro.', 'Desconsiderar impactos ambientais.', 'Respeitar licenças ambientais e princípios de sustentabilidade.', 'Ser terceirizada para evitar responsabilidades.'], correct: 2 }
    ];

    const dissertativas = [
      '21. Imagine que você é técnico de manutenção em uma indústria e observa que um colega realiza uma tarefa elétrica sem desligar o disjuntor. O que você faria nessa situação e como justificaria sua atitude com base na NR10?',
      '22. Explique, com suas palavras, o que é segurança do trabalho e como ela pode impactar diretamente o sucesso de uma empresa.',
      '23. Dê um exemplo de acidente de trabalho real (ou hipotético) que poderia ter sido evitado. Indique qual norma e qual EPI teriam evitado o acidente.',
      '24. Compare: “risco físico” e “risco químico”. Dê um exemplo de cada um em um ambiente industrial de automação.',
      '25. Explique como a NR5410 contribui para a segurança das instalações elétricas em uma planta automatizada.',
      '26. Como um programa de segurança bem estruturado pode reduzir custos e aumentar a produtividade?',
      '27. Em sua opinião, qual é o maior desafio na implementação de uma cultura de segurança dentro das empresas? Dê uma sugestão prática para melhorar isso.',
      '28. Em relação ao meio ambiente, o que um técnico em automação pode fazer para evitar poluição e desperdício de energia em processos industriais?',
      '29. Descreva uma situação real de risco que pode ocorrer com o uso incorreto de ferramentas elétricas e explique a forma correta de prevenção.',
      '30. Cite e explique duas ações práticas que mostram o compromisso da empresa com a segurança e a sustentabilidade ambiental.'
    ];

    const quizContainer = document.getElementById('quiz-container');
    const resultDiv = document.getElementById('result');
    const nameModal = document.getElementById('name-modal');

    document.getElementById('start-btn').addEventListener('click', () => {
      const name = document.getElementById('userName').value.trim();
      if (!name) {
        alert('Por favor, digite seu nome antes de iniciar.');
        return;
      }
      nameModal.style.display = 'none';
      startQuiz(name);
    });

    function startQuiz(userName) {
      let currentQuestion = 0;
      let score = 0;
      const answers = [];

      function renderQuestion() {
        const q = quizData[currentQuestion];
        quizContainer.innerHTML = `<div class='question'><h3>${q.question}</h3><div class='options'>${q.options.map((opt, i) => `<label><input type='radio' name='option' value='${i}'> ${opt}</label>`).join('')}</div><button id='next-btn'>${currentQuestion === quizData.length - 1 ? 'Avançar para dissertativas' : 'Próxima'}</button></div>`;

        document.getElementById('next-btn').addEventListener('click', () => {
          const selected = document.querySelector('input[name="option"]:checked');
          if (!selected) {
            alert('Por favor, selecione uma resposta antes de continuar.');
            return;
          }
          const answer = parseInt(selected.value);
          answers.push(answer);
          if (answer === q.correct) score++;

          currentQuestion++;
          if (currentQuestion < quizData.length) {
            renderQuestion();
          } else {
            renderDissertativas(userName, score, answers);
          }
        });
      }
      quizContainer.style.display = 'block';
      renderQuestion();
    }

    function renderDissertativas(userName, score, answers) {
      quizContainer.innerHTML = '<h2>Parte 2 – Questões Dissertativas</h2>';
      dissertativas.forEach(q => {
        quizContainer.innerHTML += `<div class='question'><p>${q}</p><textarea placeholder='Digite sua resposta aqui...'></textarea></div>`;
      });
      quizContainer.innerHTML += '<button id="finish-btn">Finalizar Avaliação</button>';

      document.getElementById('finish-btn').addEventListener('click', () => {
        const texts = Array.from(document.querySelectorAll('textarea')).map(t => t.value.trim());
        if (texts.some(t => t === '')) {
          alert('Por favor, responda todas as questões dissertativas antes de finalizar.');
          return;
        }
        showResult(userName, score, answers, texts);
      });
    }

    function showResult(userName, score, answers, texts) {
      quizContainer.style.display = 'none';
      const percentage = ((score / quizData.length) * 100).toFixed(2);
      let html = `<h2>Resultado Final</h2><p><strong>Nome:</strong> ${userName}</p><p><strong>Acertos:</strong> ${score}</p><p><strong>Erros:</strong> ${quizData.length - score}</p><p><strong>Percentual de acerto:</strong> ${percentage}%</p>`;
      resultDiv.innerHTML = html + '<button id="pdf-btn">Gerar PDF</button>';
      resultDiv.style.display = 'block';

      document.getElementById('pdf-btn').addEventListener('click', () => generatePDF(userName, score, answers, percentage, texts));
    }

    function generatePDF(userName, score, answers, percentage, texts) {
      if (!window.jspdf) {
        alert('Biblioteca jsPDF não carregada.');
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      doc.text(`Relatório de Avaliação - Segurança e Automação`, 10, y); y += 10;
      doc.text(`Nome: ${userName}`, 10, y); y += 10;
      doc.text(`Acertos: ${score}`, 10, y); y += 10;
      doc.text(`Erros: ${quizData.length - score}`, 10, y); y += 10;
      doc.text(`Percentual: ${percentage}%`, 10, y); y += 10;

      quizData.forEach((q, i) => {
        y += 10;
        doc.text(`${i+1}. ${q.question}`, 10, y);
        q.options.forEach((opt, idx) => {
          y += 8;
          const mark = idx === q.correct ? '(Correta)' : '';
          if (idx === q.correct) {
            doc.setTextColor(0, 150, 0);
          } else if (answers[i] === idx) {
            doc.setTextColor(255, 0, 0);
          } else {
            doc.setTextColor(0, 0, 0);
          }
          doc.text(`- ${opt} ${mark}`, 14, y);
        });
      });

      doc.setTextColor(0, 0, 0);
      y += 10;
      doc.text('Parte 2 – Questões Dissertativas', 10, y); y += 10;
      dissertativas.forEach((q, i) => {
        doc.text(`${q}`, 10, y); y += 8;
        const resposta = texts[i] || ''; 
        const lines = doc.splitTextToSize(`Resposta: ${resposta}`, 180);
        lines.forEach(line => { y += 6; if (y > 280) { doc.addPage(); y = 10; } doc.text(line, 10, y); });
        y += 10;
      });

      doc.save(`${userName.replace(/\s+/g,'_')}_Avaliacao.pdf`);
    }
  </script>
</body>
</html>
